
<!DOCTYPE html>


<html lang="en" data-content_root="../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>2. Dictionary inputs &#8212; thevenin 0.0.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=b2d0f202" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=d45e8c67"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/example2';</script>
    <script src="../_static/custom.js?v=e2d01366"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="thevenin" href="../api/thevenin/index.html" />
    <link rel="prev" title="1. YAML file inputs" href="example1.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
    
    <img src="../_static/light.svg" class="logo__image only-light" alt="thevenin 0.0.1 documentation - Home"/>
    <script>document.write(`<img src="../_static/dark.svg" class="logo__image only-dark" alt="thevenin 0.0.1 documentation - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/thevenin/index.html">
    API Reference
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/thevenin/index.html">
    API Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="example1.html">1. YAML file inputs</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">2. Dictionary inputs</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Examples</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="dictionary-inputs">
<h1><span class="section-number">2. </span>Dictionary inputs<a class="headerlink" href="#dictionary-inputs" title="Link to this heading">#</a></h1>
<p>In the previous example, the model parameters were built from a ‘.yaml’ file. In some cases, the functional parameters are relatively complex and can be challenging to specify in the ‘.yaml’ format. Therefore, the model can also be constructed using a dictionary, as demonstrated below.</p>
<section id="import-modules">
<h2><span class="section-number">2.1. </span>Import modules<a class="headerlink" href="#import-modules" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">import</span> <span class="nn">thevenin</span>
<span class="linenos">2</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="define-the-parameters">
<h2><span class="section-number">2.2. </span>Define the parameters<a class="headerlink" href="#define-the-parameters" title="Link to this heading">#</a></h2>
<p>In addition to the open circuit voltage (<code class="docutils literal notranslate"><span class="pre">ocv</span></code>), all circuit elements (i.e., <code class="docutils literal notranslate"><span class="pre">R0</span></code>, <code class="docutils literal notranslate"><span class="pre">R1</span></code>, <code class="docutils literal notranslate"><span class="pre">C1</span></code>, etc.) must be specified as functions. While <code class="docutils literal notranslate"><span class="pre">OCV</span></code> is only a function of the state of charge (<code class="docutils literal notranslate"><span class="pre">soc</span></code>, -), the circuit elements are function of both soc and temperature (<code class="docutils literal notranslate"><span class="pre">T_cell</span></code>, K). It is important that these are the only inputs to the functions and that the inputs are given in the correct order.</p>
<p>The functions below come from fitting the equivalent circuit model to a 75 Ah graphite-NMC battery made by Kokam. Fits were performed using charge and discharge pulses from HPPC tests done at multiple temperatures. The <code class="docutils literal notranslate"><span class="pre">soc</span></code> was assumed constant during a single pulse and each resistor and capacitor element was fit as a constant for a given soc/temperature condition. Expressions below come from AI-Batt, which is an open-source software capable of semi-autonomously identifying algebraic expressions that map inputs (<code class="docutils literal notranslate"><span class="pre">soc</span></code> and <code class="docutils literal notranslate"><span class="pre">T_cell</span></code>) to outputs (<code class="docutils literal notranslate"><span class="pre">R0</span></code>, <code class="docutils literal notranslate"><span class="pre">R1</span></code>, <code class="docutils literal notranslate"><span class="pre">C1</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">stressors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;q_dis&#39;</span><span class="p">:</span> <span class="mf">1.</span><span class="p">}</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">def</span> <span class="nf">calc_xa</span><span class="p">(</span><span class="n">soc</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="linenos"> 5</span>    <span class="k">return</span> <span class="mf">8.5e-3</span> <span class="o">+</span> <span class="n">soc</span><span class="o">*</span><span class="p">(</span><span class="mf">7.8e-1</span> <span class="o">-</span> <span class="mf">8.5e-3</span><span class="p">)</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="k">def</span> <span class="nf">calc_Ua</span><span class="p">(</span><span class="n">soc</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="linenos"> 9</span>    <span class="n">xa</span> <span class="o">=</span> <span class="n">calc_xa</span><span class="p">(</span><span class="n">soc</span><span class="p">)</span>
<span class="linenos">10</span>    <span class="n">Ua</span> <span class="o">=</span> <span class="mf">0.6379</span> <span class="o">+</span> <span class="mf">0.5416</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">305.5309</span><span class="o">*</span><span class="n">xa</span><span class="p">)</span> \
<span class="linenos">11</span>                <span class="o">+</span> <span class="mf">0.0440</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="o">*</span><span class="p">(</span><span class="n">xa</span><span class="o">-</span><span class="mf">0.1958</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.1088</span><span class="p">)</span> \
<span class="linenos">12</span>                <span class="o">-</span> <span class="mf">0.1978</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">((</span><span class="n">xa</span><span class="o">-</span><span class="mf">1.0571</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.0854</span><span class="p">)</span> \
<span class="linenos">13</span>                <span class="o">-</span> <span class="mf">0.6875</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">((</span><span class="n">xa</span><span class="o">+</span><span class="mf">0.0117</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.0529</span><span class="p">)</span> \
<span class="linenos">14</span>                <span class="o">-</span> <span class="mf">0.0175</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">((</span><span class="n">xa</span><span class="o">-</span><span class="mf">0.5692</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.0875</span><span class="p">)</span>
<span class="linenos">15</span>
<span class="linenos">16</span>    <span class="k">return</span> <span class="n">Ua</span>
<span class="linenos">17</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="k">def</span> <span class="nf">normalize_inputs</span><span class="p">(</span><span class="n">soc</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">T_cell</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="linenos">20</span>    <span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">21</span>        <span class="s1">&#39;T_norm&#39;</span><span class="p">:</span> <span class="n">T_cell</span> <span class="o">/</span> <span class="p">(</span><span class="mf">273.15</span> <span class="o">+</span> <span class="mf">35.</span><span class="p">),</span>
<span class="linenos">22</span>        <span class="s1">&#39;Ua_norm&#39;</span><span class="p">:</span> <span class="n">calc_Ua</span><span class="p">(</span><span class="n">soc</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.123</span><span class="p">,</span>
<span class="linenos">23</span>    <span class="p">}</span>
<span class="linenos">24</span>    <span class="k">return</span> <span class="n">inputs</span>
<span class="linenos">25</span>
<span class="linenos">26</span>
<span class="linenos">27</span><span class="k">def</span> <span class="nf">ocv_func</span><span class="p">(</span><span class="n">soc</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="linenos">28</span>    <span class="n">coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
<span class="linenos">29</span>        <span class="mf">1846.82880284425</span><span class="p">,</span> <span class="o">-</span><span class="mf">9142.89133579961</span><span class="p">,</span> <span class="mf">19274.3547435787</span><span class="p">,</span> <span class="o">-</span><span class="mf">22550.631463739</span><span class="p">,</span>
<span class="linenos">30</span>        <span class="mf">15988.8818738468</span><span class="p">,</span> <span class="o">-</span><span class="mf">7038.74760241881</span><span class="p">,</span> <span class="mf">1895.2432152617</span><span class="p">,</span> <span class="o">-</span><span class="mf">296.104300038221</span><span class="p">,</span>
<span class="linenos">31</span>        <span class="mf">24.6343726509044</span><span class="p">,</span> <span class="mf">2.63809042502323</span><span class="p">,</span>
<span class="linenos">32</span>    <span class="p">])</span>
<span class="linenos">33</span>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">soc</span><span class="p">)</span>
<span class="linenos">34</span>
<span class="linenos">35</span>
<span class="linenos">36</span><span class="k">def</span> <span class="nf">R0_func</span><span class="p">(</span><span class="n">soc</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">T_cell</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="linenos">37</span>    <span class="n">inputs</span> <span class="o">=</span> <span class="n">normalize_inputs</span><span class="p">(</span><span class="n">soc</span><span class="p">,</span> <span class="n">T_cell</span><span class="p">)</span>
<span class="linenos">38</span>    <span class="n">T_norm</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;T_norm&#39;</span><span class="p">]</span>
<span class="linenos">39</span>    <span class="n">Ua_norm</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Ua_norm&#39;</span><span class="p">]</span>
<span class="linenos">40</span>
<span class="linenos">41</span>    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">4.07e12</span><span class="p">,</span> <span class="mf">23.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.</span><span class="p">,</span> <span class="o">-</span><span class="mf">47.5</span><span class="p">,</span> <span class="mf">2.62</span><span class="p">])</span>
<span class="linenos">42</span>
<span class="linenos">43</span>    <span class="n">R0</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">T_norm</span><span class="o">**</span><span class="mi">4</span> <span class="o">*</span> <span class="n">Ua_norm</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="p">)</span> \
<span class="linenos">44</span>              <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">T_norm</span><span class="o">**</span><span class="mi">4</span> <span class="o">*</span> <span class="n">Ua_norm</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="p">)</span> \
<span class="linenos">45</span>              <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">T_norm</span><span class="o">**</span><span class="mf">0.5</span> <span class="p">)</span> \
<span class="linenos">46</span>              <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">b</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">/</span> <span class="n">stressors</span><span class="p">[</span><span class="s1">&#39;q_dis&#39;</span><span class="p">]</span> <span class="p">)</span>
<span class="linenos">47</span>
<span class="linenos">48</span>    <span class="k">return</span> <span class="n">R0</span>
<span class="linenos">49</span>
<span class="linenos">50</span>
<span class="linenos">51</span><span class="k">def</span> <span class="nf">R1_func</span><span class="p">(</span><span class="n">soc</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">T_cell</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="linenos">52</span>    <span class="n">inputs</span> <span class="o">=</span> <span class="n">normalize_inputs</span><span class="p">(</span><span class="n">soc</span><span class="p">,</span> <span class="n">T_cell</span><span class="p">)</span>
<span class="linenos">53</span>    <span class="n">T_norm</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;T_norm&#39;</span><span class="p">]</span>
<span class="linenos">54</span>    <span class="n">Ua_norm</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Ua_norm&#39;</span><span class="p">]</span>
<span class="linenos">55</span>
<span class="linenos">56</span>    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.84e-5</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.5</span><span class="p">,</span> <span class="mf">11.6</span><span class="p">,</span> <span class="mf">1.96</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.67</span><span class="p">])</span>
<span class="linenos">57</span>
<span class="linenos">58</span>    <span class="n">R1</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">T_norm</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">Ua_norm</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="p">)</span> \
<span class="linenos">59</span>              <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">T_norm</span><span class="o">**</span><span class="mi">4</span> <span class="o">*</span> <span class="n">Ua_norm</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="p">)</span> \
<span class="linenos">60</span>              <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">stressors</span><span class="p">[</span><span class="s1">&#39;q_dis&#39;</span><span class="p">]</span> <span class="p">)</span> \
<span class="linenos">61</span>              <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">b</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">soc</span><span class="o">**</span><span class="mi">4</span> <span class="p">)</span>
<span class="linenos">62</span>
<span class="linenos">63</span>    <span class="k">return</span> <span class="n">R1</span>
<span class="linenos">64</span>
<span class="linenos">65</span>
<span class="linenos">66</span><span class="k">def</span> <span class="nf">C1_func</span><span class="p">(</span><span class="n">soc</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">T_cell</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="linenos">67</span>    <span class="n">inputs</span> <span class="o">=</span> <span class="n">normalize_inputs</span><span class="p">(</span><span class="n">soc</span><span class="p">,</span> <span class="n">T_cell</span><span class="p">)</span>
<span class="linenos">68</span>    <span class="n">T_norm</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;T_norm&#39;</span><span class="p">]</span>
<span class="linenos">69</span>    <span class="n">Ua_norm</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Ua_norm&#39;</span><span class="p">]</span>
<span class="linenos">70</span>
<span class="linenos">71</span>    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">19.</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.11</span><span class="p">,</span> <span class="o">-</span><span class="mf">27.</span><span class="p">,</span> <span class="mf">36.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.256</span><span class="p">])</span>
<span class="linenos">72</span>
<span class="linenos">73</span>    <span class="n">C1</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">soc</span><span class="o">**</span><span class="mi">4</span> <span class="p">)</span> \
<span class="linenos">74</span>              <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">T_norm</span><span class="o">**</span><span class="mi">4</span> <span class="o">*</span> <span class="n">Ua_norm</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span> \
<span class="linenos">75</span>              <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">T_norm</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">Ua_norm</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="p">)</span> \
<span class="linenos">76</span>              <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">b</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">/</span> <span class="n">stressors</span><span class="p">[</span><span class="s1">&#39;q_dis&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span> <span class="p">)</span>
<span class="linenos">77</span>
<span class="linenos">78</span>    <span class="k">return</span> <span class="n">C1</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="construct-a-model">
<h2><span class="section-number">2.3. </span>Construct a model<a class="headerlink" href="#construct-a-model" title="Link to this heading">#</a></h2>
<p>The model is constructed below using all necessary keyword arguments. You can see a list of these parameters using <code class="docutils literal notranslate"><span class="pre">help(thevenin.Model)</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 2</span>    <span class="s1">&#39;num_RC_pairs&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="linenos"> 3</span>    <span class="s1">&#39;soc0&#39;</span><span class="p">:</span> <span class="mf">1.</span><span class="p">,</span>
<span class="linenos"> 4</span>    <span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mf">75.</span><span class="p">,</span>
<span class="linenos"> 5</span>    <span class="s1">&#39;mass&#39;</span><span class="p">:</span> <span class="mf">1.9</span><span class="p">,</span>
<span class="linenos"> 6</span>    <span class="s1">&#39;isothermal&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="linenos"> 7</span>    <span class="s1">&#39;Cp&#39;</span><span class="p">:</span> <span class="mf">745.</span><span class="p">,</span>
<span class="linenos"> 8</span>    <span class="s1">&#39;T_inf&#39;</span><span class="p">:</span> <span class="mf">300.</span><span class="p">,</span>
<span class="linenos"> 9</span>    <span class="s1">&#39;h_therm&#39;</span><span class="p">:</span> <span class="mf">12.</span><span class="p">,</span>
<span class="linenos">10</span>    <span class="s1">&#39;A_therm&#39;</span><span class="p">:</span> <span class="mf">1.</span><span class="p">,</span>
<span class="linenos">11</span>    <span class="s1">&#39;ocv&#39;</span><span class="p">:</span> <span class="n">ocv_func</span><span class="p">,</span>
<span class="linenos">12</span>    <span class="s1">&#39;R0&#39;</span><span class="p">:</span> <span class="n">R0_func</span><span class="p">,</span>
<span class="linenos">13</span>    <span class="s1">&#39;R1&#39;</span><span class="p">:</span> <span class="n">R1_func</span><span class="p">,</span>
<span class="linenos">14</span>    <span class="s1">&#39;C1&#39;</span><span class="p">:</span> <span class="n">C1_func</span><span class="p">,</span>
<span class="linenos">15</span><span class="p">}</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="n">model</span> <span class="o">=</span> <span class="n">thevenin</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="build-an-experiment">
<h2><span class="section-number">2.4. </span>Build an experiment<a class="headerlink" href="#build-an-experiment" title="Link to this heading">#</a></h2>
<p>Experiments are built using the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> class. An experiment starts out empty and is then constructed by adding a series of current-, voltage-, or power-controlled steps. Each step requires knowing the control mode/units, the control value, a relative time span, and limiting criteria (optional). Control values can be spefied as either constants or dynamic profiles with sinatures like <code class="docutils literal notranslate"><span class="pre">f(t:</span> <span class="pre">float)</span> <span class="pre">-&gt;</span> <span class="pre">float</span></code> where <code class="docutils literal notranslate"><span class="pre">t</span></code> is the relative time of the new step, in seconds. The experiment below discharges at a nominal C/5 rate for up to 5 hours. A limit is set such that if the voltage hits 3 V then the next step is triggered early. Afterward, the battery rests for 10 min before charging at C/5 for 5 hours or until 4.2 V is reached. The final step is a 1 hour voltage hold at 4.2 V.</p>
<p>Note that the time span for each step is constructed as <code class="docutils literal notranslate"><span class="pre">(t_max:</span> <span class="pre">float,</span> <span class="pre">dt:</span> <span class="pre">float)</span></code> which is used to determine the time array as <code class="docutils literal notranslate"><span class="pre">tspan</span> <span class="pre">=</span> <span class="pre">np.arange(0.,</span> <span class="pre">t_max</span> <span class="pre">+</span> <span class="pre">dt,</span> <span class="pre">dt)</span></code>. You can also construct a time array given <code class="docutils literal notranslate"><span class="pre">(t_max:</span> <span class="pre">float,</span> <span class="pre">Nt:</span> <span class="pre">int)</span></code> by using an integer instead of a float in the second position. In this case, <code class="docutils literal notranslate"><span class="pre">tspan</span> <span class="pre">=</span> <span class="pre">np.linspace(0.,</span> <span class="pre">t_max,</span> <span class="pre">Nt)</span></code>. To learn more about building an experiment, including which limits are allowed and/or how to adjust solver settings on a per-step basis, see the documnetation <code class="docutils literal notranslate"><span class="pre">help(thevenin.Experiment)</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">exp</span> <span class="o">=</span> <span class="n">thevenin</span><span class="o">.</span><span class="n">Experiment</span><span class="p">()</span>
<span class="linenos">2</span><span class="n">exp</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s1">&#39;current_A&#39;</span><span class="p">,</span> <span class="mf">15.</span><span class="p">,</span> <span class="p">(</span><span class="mf">5.</span><span class="o">*</span><span class="mf">3600.</span><span class="p">,</span> <span class="mf">60.</span><span class="p">),</span> <span class="n">limit</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;voltage_V&#39;</span><span class="p">,</span> <span class="mf">3.</span><span class="p">))</span>
<span class="linenos">3</span><span class="n">exp</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s1">&#39;current_A&#39;</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="p">(</span><span class="mf">600.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">))</span>
<span class="linenos">4</span><span class="n">exp</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s1">&#39;current_A&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">15.</span><span class="p">,</span> <span class="p">(</span><span class="mf">5.</span><span class="o">*</span><span class="mf">3600.</span><span class="p">,</span> <span class="mf">60.</span><span class="p">),</span> <span class="n">limit</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;voltage_V&#39;</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">))</span>
<span class="linenos">5</span><span class="n">exp</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s1">&#39;voltage_V&#39;</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">,</span> <span class="p">(</span><span class="mf">3600.</span><span class="p">,</span> <span class="mf">60.</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="run-the-experiment">
<h2><span class="section-number">2.5. </span>Run the experiment<a class="headerlink" href="#run-the-experiment" title="Link to this heading">#</a></h2>
<p>Experiments are run using either the <code class="docutils literal notranslate"><span class="pre">run</span></code> method, as shown below, or the <code class="docutils literal notranslate"><span class="pre">run_step</span></code> method. The difference between the two is that the <code class="docutils literal notranslate"><span class="pre">run</span></code> method will run all experiment steps with one call. If you would prefer to run the discharge first, perform an analysis, and then run the rest, etc. then you will want to use the <code class="docutils literal notranslate"><span class="pre">run_step</span></code> method. In this case, you should always start with step 0 and then run the following steps in order. When you use <code class="docutils literal notranslate"><span class="pre">run_step</span></code> the models internal state is saved at the end of each step. Therefore, after all steps have been run, you should run the <code class="docutils literal notranslate"><span class="pre">pre</span></code> method to pre-process the model back to its original initial state. All of this is handled automatically in the <code class="docutils literal notranslate"><span class="pre">run</span></code> method.</p>
<p>Regardless of how you run your experiment, the return value will be a solution instance. Solution instances each contain a <code class="docutils literal notranslate"><span class="pre">vars</span></code> attribute which contains a dictionary of the output variables. Keys are generally self descriptive and include units where applicable. To quickly plot any two variables against one another, use the <code class="docutils literal notranslate"><span class="pre">plot</span></code> method with the two keys of interest specified for the <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> variables of the figure. Below, time (in hours) is plotted against voltage.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">sol</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
<span class="linenos">2</span><span class="nb">print</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">solvetime</span><span class="p">)</span>
<span class="linenos">3</span>
<span class="linenos">4</span><span class="n">sol</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;time_h&#39;</span><span class="p">,</span> <span class="s1">&#39;voltage_V&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DLL load failed while importing ddaspk: The specified module could not be found.
DLL load failed while importing lsodi: The specified module could not be found.
Solve time: 0.104 s
</pre></div>
</div>
<img alt="../_images/edf187d31bd63477763f0f585dfacda29c2020db04133979a846e23b776cd42f.png" src="../_images/edf187d31bd63477763f0f585dfacda29c2020db04133979a846e23b776cd42f.png" />
</div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-modules">2.1. Import modules</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-parameters">2.2. Define the parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#construct-a-model">2.3. Construct a model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#build-an-experiment">2.4. Build an experiment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-the-experiment">2.5. Run the experiment</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Corey R. Randall.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    <br/>
  </p>
</div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>