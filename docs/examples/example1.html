
<!DOCTYPE html>


<html lang="en" data-content_root="../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>1. YAML file inputs &#8212; thevenin 0.0.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=b2d0f202" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=d45e8c67"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/example1';</script>
    <script src="../_static/custom.js?v=e2d01366"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2. Dictionary inputs" href="example2.html" />
    <link rel="prev" title="Examples" href="index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
    
    <img src="../_static/light.svg" class="logo__image only-light" alt="thevenin 0.0.1 documentation - Home"/>
    <script>document.write(`<img src="../_static/dark.svg" class="logo__image only-dark" alt="thevenin 0.0.1 documentation - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/thevenin/index.html">
    API Reference
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/thevenin/index.html">
    API Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">1. YAML file inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="example2.html">2. Dictionary inputs</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Examples</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="yaml-file-inputs">
<h1><span class="section-number">1. </span>YAML file inputs<a class="headerlink" href="#yaml-file-inputs" title="Link to this heading">#</a></h1>
<p>This basic example will walk you through understanding the three main classes required to build and exercise equivalent circuit models using this package. The three classes as the <code class="docutils literal notranslate"><span class="pre">Model</span></code>, <code class="docutils literal notranslate"><span class="pre">Experiment</span></code>, and <code class="docutils literal notranslate"><span class="pre">StepSolution</span></code> or <code class="docutils literal notranslate"><span class="pre">CylceSolution</span></code> classes. Models hold parameters associated with defining the battery circuit, experiments list a series of sequential steps that define a test protocol or duty cycle, and the solution classes provide an interface to access, manipulate, and/or plot the solution.</p>
<section id="import-modules">
<h2><span class="section-number">1.1. </span>Import modules<a class="headerlink" href="#import-modules" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">import</span> <span class="nn">thevenin</span>
<span class="linenos">2</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="construct-a-model">
<h2><span class="section-number">1.2. </span>Construct a model<a class="headerlink" href="#construct-a-model" title="Link to this heading">#</a></h2>
<p>The model class can be constructed using either a ‘.yaml’ file or a dictionary that specifies all keyword arguments shown in the documentation (<code class="docutils literal notranslate"><span class="pre">help(thevenin.Model)</span></code>). A default ‘.yaml’ file is read in when no input is provided. This is simply for convenience to help users get up and going as quickly as possible. However, you should learn how to write your own ‘.yaml’ file or dictionary input if you would like to use this package to its fullest extent.</p>
<p>The ‘.yaml’ format is very similar to building a dictionary in Python. Use the default ‘params.yaml’ file given below as a template for your own files. Note that the open circuit voltage <code class="docutils literal notranslate"><span class="pre">ocv</span></code> and circuit elements (<code class="docutils literal notranslate"><span class="pre">R0</span></code>, <code class="docutils literal notranslate"><span class="pre">R1</span></code>, and <code class="docutils literal notranslate"><span class="pre">C1</span></code>) must be input as a <code class="docutils literal notranslate"><span class="pre">Callable</span></code> with the correct inputs in the correct order, i.e., <code class="docutils literal notranslate"><span class="pre">f(soc:</span> <span class="pre">float)</span> <span class="pre">-&gt;</span> <span class="pre">float</span></code> for <code class="docutils literal notranslate"><span class="pre">ocv</span></code> and <code class="docutils literal notranslate"><span class="pre">f(soc:</span> <span class="pre">float,</span> <span class="pre">T_cell:</span> <span class="pre">float)</span> <span class="pre">-&gt;</span> <span class="pre">float</span></code> for all RC elements. The inputs represent the state of charge (<code class="docutils literal notranslate"><span class="pre">soc</span></code>, -) and cell tempearture (<code class="docutils literal notranslate"><span class="pre">T_cell</span></code>, K). Resistor and capacitor outputs should be in Ohm and F, respectively. Since ‘.yaml’ files do not natively support python functions, this package uses a custom <code class="docutils literal notranslate"><span class="pre">!eval</span></code> constructor to interpret functional parameters. The <code class="docutils literal notranslate"><span class="pre">!eval</span></code> constructor should be followed by a pipe <code class="docutils literal notranslate"><span class="pre">|</span></code> so that the interpretor does not get confused by the colon in the <code class="docutils literal notranslate"><span class="pre">lambda</span></code> expression. <code class="docutils literal notranslate"><span class="pre">np</span></code> expressions and basic math are also supported when using the <code class="docutils literal notranslate"><span class="pre">!eval</span></code> constructor.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">num_RC_pairs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">soc0</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.</span>
<span class="nt">capacity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">75.</span>
<span class="nt">mass</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.9</span>
<span class="nt">isothermal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="nt">Cp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">745.</span>
<span class="nt">T_inf</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300.</span>
<span class="nt">h_therm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">12.</span>
<span class="nt">A_therm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.</span>
<span class="nt">ocv</span><span class="p">:</span><span class="w"> </span><span class="kt">!eval</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"> </span>
<span class="w">    </span><span class="no">lambda soc:   84.6*soc**7 - 348.6*soc**6 + 592.3*soc**5 - 534.3*soc**4 \</span>
<span class="w">                </span><span class="no">+ 275.*soc**3 - 80.3*soc**2 + 12.8*soc + 2.8</span>
<span class="nt">R0</span><span class="p">:</span><span class="w"> </span><span class="kt">!eval</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">lambda soc, T_cell: 1e-4 + soc/1e5 - T_cell/3e7</span>
<span class="nt">R1</span><span class="p">:</span><span class="w"> </span><span class="kt">!eval</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">lambda soc, T_cell: 1e-5 + soc/1e5 - T_cell/3e7</span>
<span class="nt">C1</span><span class="p">:</span><span class="w"> </span><span class="kt">!eval</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">lambda soc, T_cell: 1e4 + soc*1e4 + np.exp(T_cell/300.)</span>
</pre></div>
</div>
<p>Although this example only uses a single RC pair, <code class="docutils literal notranslate"><span class="pre">num_RC_pairs</span></code> can be as low as 0 and can be as high as <span class="math notranslate nohighlight">\(N\)</span>. The number of defined <code class="docutils literal notranslate"><span class="pre">Rj</span></code> and <code class="docutils literal notranslate"><span class="pre">Cj</span></code> elements in the ‘.yaml’ file should be consistant with <code class="docutils literal notranslate"><span class="pre">num_RC_pairs</span></code>. For example, if <code class="docutils literal notranslate"><span class="pre">num_RC_pairs=0</span></code> then only <code class="docutils literal notranslate"><span class="pre">R0</span></code> should be defined, with no other resitors or capacitors. However, if <code class="docutils literal notranslate"><span class="pre">num_RC_pairs=3</span></code> then the user should specify <code class="docutils literal notranslate"><span class="pre">R0</span></code>, <code class="docutils literal notranslate"><span class="pre">R1</span></code>, <code class="docutils literal notranslate"><span class="pre">R2</span></code>, <code class="docutils literal notranslate"><span class="pre">R3</span></code>, <code class="docutils literal notranslate"><span class="pre">C1</span></code>, <code class="docutils literal notranslate"><span class="pre">C2</span></code>, and <code class="docutils literal notranslate"><span class="pre">C3</span></code>. Note that the series resistor element <code class="docutils literal notranslate"><span class="pre">R0</span></code> is always included, even when there are no RC pairs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">model</span> <span class="o">=</span> <span class="n">thevenin</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[thevenin UserWarning]: Using the default parameter file &#39;params.yaml&#39;.
</pre></div>
</div>
</div>
</div>
<p>When using the default parameters, a warning will always print. This is to ensure the user is running with their preferred inputs. In the case that a user has a file by the same name, the package will take the default as its preference. Be sure to specify the local or absolute path in this case, e.g., <code class="docutils literal notranslate"><span class="pre">./params.yaml</span></code>, or simply rename your file.</p>
</section>
<section id="build-an-experiment">
<h2><span class="section-number">1.3. </span>Build an experiment<a class="headerlink" href="#build-an-experiment" title="Link to this heading">#</a></h2>
<p>Experiments are built using the <code class="docutils literal notranslate"><span class="pre">Experiment</span></code> class. An experiment starts out empty and is then constructed by adding a series of current-, voltage-, or power-controlled steps. Each step requires knowing the control mode/units, the control value, a relative time span, and limiting criteria (optional). Control values can be spefied as either constants or dynamic profiles with sinatures like <code class="docutils literal notranslate"><span class="pre">f(t:</span> <span class="pre">float)</span> <span class="pre">-&gt;</span> <span class="pre">float</span></code> where <code class="docutils literal notranslate"><span class="pre">t</span></code> is the relative time of the new step, in seconds. The experiment below discharges at a nominal 1C rate for up to 1 hour. A limit is set such that if the voltage hits 3 V then the next step is triggered early. Afterward, the battery rests for 10 min before charging at 1C for 1 hours or until 4.3 V is reached. The remaining three steps perform a voltage hold at 4.3 V for 10 min, a constant power profile of 200 W for 1 hour or until 3.8 V is reached, and a sinusoidal voltage load for 10 min centered around 3.8 V.</p>
<p>Note that the time span for each step is constructed as <code class="docutils literal notranslate"><span class="pre">(t_max:</span> <span class="pre">float,</span> <span class="pre">dt:</span> <span class="pre">float)</span></code> which is used to determine the time array as <code class="docutils literal notranslate"><span class="pre">tspan</span> <span class="pre">=</span> <span class="pre">np.arange(0.,</span> <span class="pre">t_max</span> <span class="pre">+</span> <span class="pre">dt,</span> <span class="pre">dt)</span></code>. You can also construct a time array given <code class="docutils literal notranslate"><span class="pre">(t_max:</span> <span class="pre">float,</span> <span class="pre">Nt:</span> <span class="pre">int)</span></code> by using an integer instead of a float in the second position. In this case, <code class="docutils literal notranslate"><span class="pre">tspan</span> <span class="pre">=</span> <span class="pre">np.linspace(0.,</span> <span class="pre">t_max,</span> <span class="pre">Nt)</span></code>. To learn more about building an experiment, including which limits are allowed and/or how to adjust solver settings on a per-step basis, see the documnetation <code class="docutils literal notranslate"><span class="pre">help(thevenin.Experiment)</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">load</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="mf">10e-3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">t</span> <span class="o">/</span> <span class="mf">120.</span><span class="p">)</span> <span class="o">+</span> <span class="mf">3.8</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="n">exp</span> <span class="o">=</span> <span class="n">thevenin</span><span class="o">.</span><span class="n">Experiment</span><span class="p">(</span><span class="n">max_dt</span><span class="o">=</span><span class="mf">10.</span><span class="p">)</span>
<span class="linenos">4</span><span class="n">exp</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s1">&#39;current_A&#39;</span><span class="p">,</span> <span class="mf">75.</span><span class="p">,</span> <span class="p">(</span><span class="mf">3600.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">limit</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;voltage_V&#39;</span><span class="p">,</span> <span class="mf">3.</span><span class="p">))</span>
<span class="linenos">5</span><span class="n">exp</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s1">&#39;current_A&#39;</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="p">(</span><span class="mf">600.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">))</span>
<span class="linenos">6</span><span class="n">exp</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s1">&#39;current_A&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">75.</span><span class="p">,</span> <span class="p">(</span><span class="mf">3600.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">limit</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;voltage_V&#39;</span><span class="p">,</span> <span class="mf">4.3</span><span class="p">))</span>
<span class="linenos">7</span><span class="n">exp</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s1">&#39;voltage_V&#39;</span><span class="p">,</span> <span class="mf">4.3</span><span class="p">,</span> <span class="p">(</span><span class="mf">600.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">))</span>
<span class="linenos">8</span><span class="n">exp</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s1">&#39;power_W&#39;</span><span class="p">,</span> <span class="mf">200.</span><span class="p">,</span> <span class="p">(</span><span class="mf">3600.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">limit</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;voltage_V&#39;</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">))</span>
<span class="linenos">9</span><span class="n">exp</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="s1">&#39;voltage_V&#39;</span><span class="p">,</span> <span class="n">load</span><span class="p">,</span> <span class="p">(</span><span class="mf">600.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="run-the-experiment">
<h2><span class="section-number">1.4. </span>Run the experiment<a class="headerlink" href="#run-the-experiment" title="Link to this heading">#</a></h2>
<p>Experiments are run using either the <code class="docutils literal notranslate"><span class="pre">run</span></code> method, as shown below, or the <code class="docutils literal notranslate"><span class="pre">run_step</span></code> method. The difference between the two is that the <code class="docutils literal notranslate"><span class="pre">run</span></code> method will run all experiment steps with one call. If you would prefer to run the discharge first, perform an analysis, and then run the rest, etc. then you will want to use the <code class="docutils literal notranslate"><span class="pre">run_step</span></code> method. In this case, you should always start with step 0 and then run the following steps in order. When you use <code class="docutils literal notranslate"><span class="pre">run_step</span></code> the models internal state is saved at the end of each step. Therefore, after all steps have been run, you should run the <code class="docutils literal notranslate"><span class="pre">pre</span></code> method to pre-process the model back to its original initial state. All of this is handled automatically in the <code class="docutils literal notranslate"><span class="pre">run</span></code> method.</p>
<p>Regardless of how you run your experiment, the return value will be a solution instance. Solution instances each contain a <code class="docutils literal notranslate"><span class="pre">vars</span></code> attribute which contains a dictionary of the output variables. Keys are generally self descriptive and include units where applicable. To quickly plot any two variables against one another, use the <code class="docutils literal notranslate"><span class="pre">plot</span></code> method with the two keys of interest specified for the <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> variables of the figure. Below, time (in hours) is plotted against voltage.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">sol</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>
<span class="linenos">2</span><span class="nb">print</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">solvetime</span><span class="p">)</span>
<span class="linenos">3</span>
<span class="linenos">4</span><span class="n">sol</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;time_h&#39;</span><span class="p">,</span> <span class="s1">&#39;voltage_V&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DLL load failed while importing ddaspk: The specified module could not be found.
DLL load failed while importing lsodi: The specified module could not be found.
Solve time: 0.079 s
</pre></div>
</div>
<img alt="../_images/68d9a02cab54eb90e58547a4140a9f76f152e0903ed91e8df5a28672ecfb07a4.png" src="../_images/68d9a02cab54eb90e58547a4140a9f76f152e0903ed91e8df5a28672ecfb07a4.png" />
</div>
</div>
<p>To run step-by-step, perform the following.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># Run each index, starting with 0</span>
<span class="linenos"> 2</span><span class="n">sols</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 3</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">num_steps</span><span class="p">):</span>
<span class="linenos"> 4</span>    <span class="n">sols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">run_step</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
<span class="linenos"> 5</span>    
<span class="linenos"> 6</span><span class="c1"># Re-run the pre-processor in case you&#39;d like to run another experiment</span>
<span class="linenos"> 7</span><span class="n">model</span><span class="o">.</span><span class="n">pre</span><span class="p">()</span>
<span class="linenos"> 8</span>    
<span class="linenos"> 9</span><span class="c1"># Look at the first step solution (i.e., the 1C discharge)</span>
<span class="linenos">10</span><span class="n">sols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;time_h&#39;</span><span class="p">,</span> <span class="s1">&#39;voltage_V&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/dacecaf37cb73591c45eac816ed60b5ffe4c6259bb843d4d703e9b956aca4a7f.png" src="../_images/dacecaf37cb73591c45eac816ed60b5ffe4c6259bb843d4d703e9b956aca4a7f.png" />
</div>
</div>
<p>If you run an experiment step-by-step, you can also manually stitch them together into a <code class="docutils literal notranslate"><span class="pre">CycleSolution</span></code> once you are finshed. Alternatively, if you have a <code class="docutils literal notranslate"><span class="pre">CycleSolution</span></code>, you can pull a single <code class="docutils literal notranslate"><span class="pre">StepSolution</span></code> or a subset of the <code class="docutils literal notranslate"><span class="pre">CycleSolution</span></code> using the <code class="docutils literal notranslate"><span class="pre">get_steps</span></code> method. See below for an example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Stitch the step solutions together</span>
<span class="linenos">2</span><span class="n">cycle_soln</span> <span class="o">=</span> <span class="n">thevenin</span><span class="o">.</span><span class="n">CycleSolution</span><span class="p">(</span><span class="o">*</span><span class="n">sols</span><span class="p">)</span>
<span class="linenos">3</span><span class="n">cycle_soln</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;time_h&#39;</span><span class="p">,</span> <span class="s1">&#39;voltage_V&#39;</span><span class="p">)</span>
<span class="linenos">4</span>
<span class="linenos">5</span><span class="c1"># Pull steps 1--3 (inclusive)</span>
<span class="linenos">6</span><span class="n">some_steps</span> <span class="o">=</span> <span class="n">cycle_soln</span><span class="o">.</span><span class="n">get_steps</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="linenos">7</span><span class="n">some_steps</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;time_h&#39;</span><span class="p">,</span> <span class="s1">&#39;voltage_V&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/68d9a02cab54eb90e58547a4140a9f76f152e0903ed91e8df5a28672ecfb07a4.png" src="../_images/68d9a02cab54eb90e58547a4140a9f76f152e0903ed91e8df5a28672ecfb07a4.png" />
<img alt="../_images/782cc630086d8a5cd7829cf91e4f1371f05851aaf1e1d01a5a0b85cbe8d926e8.png" src="../_images/782cc630086d8a5cd7829cf91e4f1371f05851aaf1e1d01a5a0b85cbe8d926e8.png" />
</div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-modules">1.1. Import modules</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#construct-a-model">1.2. Construct a model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#build-an-experiment">1.3. Build an experiment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-the-experiment">1.4. Run the experiment</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Corey R. Randall.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    <br/>
  </p>
</div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>